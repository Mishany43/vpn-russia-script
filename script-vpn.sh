#!/bin/bash
# ==============================================================================
# WireGuard ALL-IN-ONE Generator
# –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç - –≤—Å—ë —Å–æ–∑–¥–∞—Å—Ç –∏ —Å–∫–∞—á–∞–µ—Ç —Å–∞–º
# ==============================================================================

# –¶–≤–µ—Ç–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
CONFIG_DIR="$HOME/wg-auto-config"
SERVER_CONFIG="$CONFIG_DIR/wg0-server.conf"
CLIENT_CONFIG="$CONFIG_DIR/wg0-client.conf"
KEYS_FILE="$CONFIG_DIR/wg-keys.txt"
EXPORT_FILE="$CONFIG_DIR/wg-export-all.txt"
LOG_FILE="/tmp/wg-auto-$(date +%s).log"

# –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
log() {
    echo -e "$1" | tee -a "$LOG_FILE"
}

# –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—à–∏–±–æ–∫
check_error() {
    if [ $? -ne 0 ]; then
        log "${RED}–û–®–ò–ë–ö–ê: $1${NC}"
        log "${YELLOW}–ü—Ä–æ–±—É—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥...${NC}"
        return 1
    fi
    return 0
}

# ==============================================================================
# –®–ê–ì 1: –£–°–¢–ê–ù–û–í–ö–ê –í–°–ï–• –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô (–ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è)
# ==============================================================================
install_all_dependencies() {
    log "${CYAN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    log "${CYAN}‚ïë          –®–ê–ì 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π            ‚ïë${NC}"
    log "${CYAN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    
    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤
    log "${BLUE}‚ñ™ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–∞–∫–µ—Ç–æ–≤...${NC}"
    if command -v apt &> /dev/null; then
        sudo apt update -y > /dev/null 2>&1
        PKG_MGR="apt"
    elif command -v yum &> /dev/null; then
        sudo yum check-update -y > /dev/null 2>&1
        PKG_MGR="yum"
    elif command -v dnf &> /dev/null; then
        sudo dnf check-update -y > /dev/null 2>&1
        PKG_MGR="dnf"
    elif command -v pacman &> /dev/null; then
        sudo pacman -Sy --noconfirm > /dev/null 2>&1
        PKG_MGR="pacman"
    elif command -v apk &> /dev/null; then
        sudo apk update > /dev/null 2>&1
        PKG_MGR="apk"
    else
        log "${YELLOW}‚ö† –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–∞–∫–µ—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä, –ø—Ä–æ–ø—É—Å–∫–∞—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ${NC}"
        PKG_MGR="unknown"
    fi
    
    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ WireGuard
    log "${BLUE}‚ñ™ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ WireGuard...${NC}"
    case $PKG_MGR in
        apt)
            sudo apt install -y wireguard wireguard-tools qrencode curl jq > /dev/null 2>&1
            ;;
        yum)
            sudo yum install -y epel-release > /dev/null 2>&1
            sudo yum install -y wireguard-tools qrencode curl jq > /dev/null 2>&1
            ;;
        dnf)
            sudo dnf install -y wireguard-tools qrencode curl jq > /dev/null 2>&1
            ;;
        pacman)
            sudo pacman -S --noconfirm wireguard-tools qrencode curl jq > /dev/null 2>&1
            ;;
        apk)
            sudo apk add wireguard-tools qrencode curl jq > /dev/null 2>&1
            ;;
        *)
            log "${YELLOW}‚ö† –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Ä—É—á–Ω—É—é: wireguard-tools qrencode curl jq${NC}"
            ;;
    esac
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
    log "${BLUE}‚ñ™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤...${NC}"
    WG_OK=0
    QR_OK=0
    
    if command -v wg &> /dev/null; then
        log "${GREEN}‚úì WireGuard —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω${NC}"
        WG_OK=1
    else
        log "${RED}‚úó WireGuard –ù–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω${NC}"
        
        # –ü–æ–ø—ã—Ç–∫–∞ —Ä—É—á–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤
        log "${YELLOW}–ü–æ–ø—ã—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤...${NC}"
        sudo apt install -y git build-essential libmnl-dev libelf-dev linux-headers-$(uname -r) > /dev/null 2>&1
        cd /tmp
        git clone https://git.zx2c4.com/wireguard-tools > /dev/null 2>&1
        cd wireguard-tools/src
        make > /dev/null 2>&1 && sudo make install > /dev/null 2>&1
        if command -v wg &> /dev/null; then
            log "${GREEN}‚úì WireGuard —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤${NC}"
            WG_OK=1
        fi
    fi
    
    if command -v qrencode &> /dev/null; then
        log "${GREEN}‚úì QRencode —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω${NC}"
        QR_OK=1
    else
        log "${YELLOW}‚ö† QRencode –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (QR-–∫–æ–¥—ã –Ω–µ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å)${NC}"
    fi
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
    log "${BLUE}‚ñ™ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—á–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π...${NC}"
    mkdir -p "$CONFIG_DIR" "$CONFIG_DIR/qr-codes" "$CONFIG_DIR/backup"
    log "${GREEN}‚úì –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∞: $CONFIG_DIR${NC}"
    
    return $((WG_OK))
}

# ==============================================================================
# –®–ê–ì 2: –ì–ï–ù–ï–†–ê–¶–ò–Ø –í–°–ï–• –ö–õ–Æ–ß–ï–ô –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò
# ==============================================================================
generate_all_keys() {
    log "\n${CYAN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    log "${CYAN}‚ïë          –®–ê–ì 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π                   ‚ïë${NC}"
    log "${CYAN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π —Å–µ—Ä–≤–µ—Ä–∞
    log "${BLUE}‚ñ™ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π —Å–µ—Ä–≤–µ—Ä–∞...${NC}"
    SERVER_PRIVATE_KEY=$(wg genkey 2>/dev/null || openssl rand -base64 32)
    SERVER_PUBLIC_KEY=$(echo "$SERVER_PRIVATE_KEY" | wg pubkey 2>/dev/null || echo "MANUAL_KEY_$(date +%s)")
    check_error "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π —Å–µ—Ä–≤–µ—Ä–∞" || {
        SERVER_PRIVATE_KEY="MANUAL_PRIVATE_KEY_$(date +%s)_$(openssl rand -hex 16)"
        SERVER_PUBLIC_KEY="MANUAL_PUBLIC_KEY_$(date +%s)_$(openssl rand -hex 16)"
    }
    
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π –∫–ª–∏–µ–Ω—Ç–∞
    log "${BLUE}‚ñ™ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π –∫–ª–∏–µ–Ω—Ç–∞...${NC}"
    CLIENT_PRIVATE_KEY=$(wg genkey 2>/dev/null || openssl rand -base64 32)
    CLIENT_PUBLIC_KEY=$(echo "$CLIENT_PRIVATE_KEY" | wg pubkey 2>/dev/null || echo "CLIENT_KEY_$(date +%s)")
    check_error "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π –∫–ª–∏–µ–Ω—Ç–∞" || {
        CLIENT_PRIVATE_KEY="CLIENT_PRIVATE_KEY_$(date +%s)_$(openssl rand -hex 16)"
        CLIENT_PUBLIC_KEY="CLIENT_PUBLIC_KEY_$(date +%s)_$(openssl rand -hex 16)"
    }
    
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PSK (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    log "${BLUE}‚ñ™ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–±—â–µ–≥–æ –∫–ª—é—á–∞...${NC}"
    PRESHARED_KEY=$(wg genpsk 2>/dev/null || openssl rand -base64 32 || date +%s | sha256sum | head -c 64)
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–ª—é—á–µ–π –≤ —Ñ–∞–π–ª
    log "${BLUE}‚ñ™ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π –≤ —Ñ–∞–π–ª...${NC}"
    cat > "$KEYS_FILE" << EOF
# ==============================================
# WIREGUARD KEYS - –°–û–•–†–ê–ù–ò–¢–ï –≠–¢–û–¢ –§–ê–ô–õ –ë–ï–ó–û–ü–ê–°–ù–û!
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: $(date)
# ==============================================

=== –°–ï–†–í–ï–† ===
–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á —Å–µ—Ä–≤–µ—Ä–∞:
${SERVER_PRIVATE_KEY}

–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å–µ—Ä–≤–µ—Ä–∞:
${SERVER_PUBLIC_KEY}

=== –ö–õ–ò–ï–ù–¢ ===
–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –∫–ª–∏–µ–Ω—Ç–∞:
${CLIENT_PRIVATE_KEY}

–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –∫–ª–∏–µ–Ω—Ç–∞:
${CLIENT_PUBLIC_KEY}

=== –û–ë–©–ò–ô –ö–õ–Æ–ß (PSK) ===
${PRESHARED_KEY}

=== –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ü–†–û–í–ï–†–ö–ò ===
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á: echo '<–ø—Ä–∏–≤–∞—Ç–Ω—ã–π_–∫–ª—é—á>' | wg pubkey
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: sudo wg show

=== –ë–´–°–¢–†–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê ===
1. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ: sudo wg-quick up $SERVER_CONFIG
2. –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ: sudo wg-quick up $CLIENT_CONFIG
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: ping 10.8.0.1 (—Å –∫–ª–∏–µ–Ω—Ç–∞) –∏ ping 10.8.0.2 (—Å —Å–µ—Ä–≤–µ—Ä–∞)
EOF
    
    chmod 600 "$KEYS_FILE"
    log "${GREEN}‚úì –ö–ª—é—á–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤: $KEYS_FILE${NC}"
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É–±–ª–∏—á–Ω—ã–µ –∫–ª—é—á–∏
    log "${BLUE}‚ñ™ –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å–µ—Ä–≤–µ—Ä–∞ (–¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤):${NC}"
    echo "$SERVER_PUBLIC_KEY"
    log "${BLUE}‚ñ™ –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –∫–ª–∏–µ–Ω—Ç–∞ (–¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞):${NC}"
    echo "$CLIENT_PUBLIC_KEY"
}

# ==============================================================================
# –®–ê–ì 3: –°–û–ó–î–ê–ù–ò–ï –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò –°–ï–†–í–ï–†–ê
# ==============================================================================
create_server_config() {
    log "\n${CYAN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    log "${CYAN}‚ïë          –®–ê–ì 3: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞               ‚ïë${NC}"
    log "${CYAN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ IP
    log "${BLUE}‚ñ™ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ IP –∞–¥—Ä–µ—Å–∞...${NC}"
    EXTERNAL_IP=$(curl -s --max-time 3 https://api.ipify.org || \
                  curl -s --max-time 3 https://checkip.amazonaws.com || \
                  curl -s --max-time 3 https://ifconfig.me/ip || \
                  echo "YOUR_SERVER_IP")
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞ —Å–µ—Ä–≤–µ—Ä–∞
    log "${BLUE}‚ñ™ –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞...${NC}"
    cat > "$SERVER_CONFIG" << EOF
# ==============================================
# WIREGUARD SERVER CONFIGURATION
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: $(date)
# –°–µ—Ä–≤–µ—Ä: ${EXTERNAL_IP}:51820
# ==============================================

[Interface]
Address = 10.8.0.1/24
ListenPort = 51820
PrivateKey = ${SERVER_PRIVATE_KEY}
MTU = 1420
SaveConfig = true

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE; ip6tables -A FORWARD -i %i -j ACCEPT; ip6tables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE; ip6tables -D FORWARD -i %i -j ACCEPT; ip6tables -t nat -D POSTROUTING -o eth0 -j MASQUERADE

# DNS –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# PostUp = iptables -t nat -A PREROUTING -i %i -p udp --dport 53 -j DNAT --to-destination 1.1.1.1:53

# ==============================================
# –ö–õ–ò–ï–ù–¢–´ (–¥–æ–±–∞–≤–ª—è—Ç—å –Ω–∏–∂–µ)
# ==============================================

# –ö–ª–∏–µ–Ω—Ç 1 (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω)
[Peer]
PublicKey = ${CLIENT_PUBLIC_KEY}
AllowedIPs = 10.8.0.2/32
PresharedKey = ${PRESHARED_KEY}
# PersistentKeepalive = 25 (—Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –∑–∞ NAT)

# –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤:
# [Peer]
# PublicKey = <–ø—É–±–ª–∏—á–Ω—ã–π_–∫–ª—é—á_–∫–ª–∏–µ–Ω—Ç–∞>
# AllowedIPs = 10.8.0.X/32
# PresharedKey = <–æ–±—â–∏–π_–∫–ª—é—á> (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
EOF
    
    chmod 600 "$SERVER_CONFIG"
    log "${GREEN}‚úì –ö–æ–Ω—Ñ–∏–≥ —Å–µ—Ä–≤–µ—Ä–∞ —Å–æ–∑–¥–∞–Ω: $SERVER_CONFIG${NC}"
    
    # –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–æ–º
    log "${BLUE}‚ñ™ –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è...${NC}"
    cat > "$CONFIG_DIR/start-server.sh" << 'EOF'
#!/bin/bash
echo "–ó–∞–ø—É—Å–∫ WireGuard —Å–µ—Ä–≤–µ—Ä–∞..."
sudo wg-quick up wg0-server.conf
echo "–°—Ç–∞—Ç—É—Å:"
sudo wg show
echo ""
echo "–î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: sudo wg-quick down wg0-server.conf"
EOF
    
    cat > "$CONFIG_DIR/stop-server.sh" << 'EOF'
#!/bin/bash
echo "–û—Å—Ç–∞–Ω–æ–≤–∫–∞ WireGuard —Å–µ—Ä–≤–µ—Ä–∞..."
sudo wg-quick down wg0-server.conf
echo "–°–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
EOF
    
    chmod +x "$CONFIG_DIR/start-server.sh" "$CONFIG_DIR/stop-server.sh"
    log "${GREEN}‚úì –°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω—ã${NC}"
}

# ==============================================================================
# –®–ê–ì 4: –°–û–ó–î–ê–ù–ò–ï –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò –ö–õ–ò–ï–ù–¢–ê
# ==============================================================================
create_client_config() {
    log "\n${CYAN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    log "${CYAN}‚ïë          –®–ê–ì 4: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞               ‚ïë${NC}"
    log "${CYAN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º IP –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (–≤—Ç–æ—Ä–æ–π –≤ –ø–æ–¥—Å–µ—Ç–∏)
    CLIENT_IP="10.8.0.2"
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞ –∫–ª–∏–µ–Ω—Ç–∞
    log "${BLUE}‚ñ™ –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞...${NC}"
    cat > "$CLIENT_CONFIG" << EOF
[Interface]
PrivateKey = ${CLIENT_PRIVATE_KEY}
Address = ${CLIENT_IP}/24
DNS = 1.1.1.1, 8.8.8.8, 208.67.222.222
MTU = 1420

[Peer]
PublicKey = ${SERVER_PUBLIC_KEY}
Endpoint = ${EXTERNAL_IP}:51820
AllowedIPs = 0.0.0.0/0, ::/0
PresharedKey = ${PRESHARED_KEY}
PersistentKeepalive = 25
EOF
    
    chmod 600 "$CLIENT_CONFIG"
    log "${GREEN}‚úì –ö–æ–Ω—Ñ–∏–≥ –∫–ª–∏–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞–Ω: $CLIENT_CONFIG${NC}"
    
    # –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–º
    log "${BLUE}‚ñ™ –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–º...${NC}"
    cat > "$CONFIG_DIR/start-client.sh" << 'EOF'
#!/bin/bash
echo "–ó–∞–ø—É—Å–∫ WireGuard –∫–ª–∏–µ–Ω—Ç–∞..."
sudo wg-quick up wg0-client.conf
echo "–°—Ç–∞—Ç—É—Å:"
sudo wg show
echo ""
echo "–î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: sudo wg-quick down wg0-client.conf"
EOF
    
    chmod +x "$CONFIG_DIR/start-client.sh"
    
    # –°–æ–∑–¥–∞–Ω–∏–µ —É–ø—Ä–æ—â—ë–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    log "${BLUE}‚ñ™ –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–±–∏–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...${NC}"
    cat > "$CONFIG_DIR/wg-mobile.conf" << EOF
[Interface]
PrivateKey = ${CLIENT_PRIVATE_KEY}
Address = ${CLIENT_IP}/24
DNS = 1.1.1.1

[Peer]
PublicKey = ${SERVER_PUBLIC_KEY}
Endpoint = ${EXTERNAL_IP}:51820
AllowedIPs = 0.0.0.0/0
PresharedKey = ${PRESHARED_KEY}
PersistentKeepalive = 25
EOF
}

# ==============================================================================
# –®–ê–ì 5: –°–û–ó–î–ê–ù–ò–ï QR-–ö–û–î–û–í –ò –≠–ö–°–ü–û–†–¢
# ==============================================================================
create_qr_and_export() {
    log "\n${CYAN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    log "${CYAN}‚ïë          –®–ê–ì 5: –°–æ–∑–¥–∞–Ω–∏–µ QR-–∫–æ–¥–æ–≤ –∏ —ç–∫—Å–ø–æ—Ä—Ç        ‚ïë${NC}"
    log "${CYAN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    
    # –°–æ–∑–¥–∞–Ω–∏–µ QR-–∫–æ–¥–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞
    if command -v qrencode &> /dev/null; then
        log "${BLUE}‚ñ™ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞...${NC}"
        qrencode -o "$CONFIG_DIR/qr-codes/client-config.png" < "$CLIENT_CONFIG"
        qrencode -t UTF8 < "$CLIENT_CONFIG" > "$CONFIG_DIR/qr-codes/client-qr.txt"
        log "${GREEN}‚úì QR-–∫–æ–¥ —Å–æ–∑–¥–∞–Ω: $CONFIG_DIR/qr-codes/client-config.png${NC}"
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º QR-–∫–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏
        log "${BLUE}‚ñ™ –¢–µ–∫—Å—Ç–æ–≤—ã–π QR-–∫–æ–¥ (–¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ):${NC}"
        qrencode -t UTF8 < "$CLIENT_CONFIG" | head -20
    else
        log "${YELLOW}‚ö† QRencode –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞—é —Å–æ–∑–¥–∞–Ω–∏–µ QR-–∫–æ–¥–æ–≤${NC}"
    fi
    
    # –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ —Å–æ –≤—Å–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
    log "${BLUE}‚ñ™ –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞...${NC}"
    cat > "$EXPORT_FILE" << EOF
# ==============================================
# WIREGUARD COMPLETE EXPORT
# –í—Å—ë –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ WireGuard VPN
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: $(date)
# ==============================================

–î–ò–†–ï–ö–¢–û–†–ò–Ø –ö–û–ù–§–ò–ì–û–í: $CONFIG_DIR

1. –ö–õ–Æ–ß–ò (–°–û–•–†–ê–ù–ò–¢–ï –ë–ï–ó–û–ü–ê–°–ù–û!):
$(cat "$KEYS_FILE")

2. –ö–û–ù–§–ò–ì –°–ï–†–í–ï–†–ê ($SERVER_CONFIG):
$(cat "$SERVER_CONFIG")

3. –ö–û–ù–§–ò–ì –ö–õ–ò–ï–ù–¢–ê ($CLIENT_CONFIG):
$(cat "$CLIENT_CONFIG")

4. –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ó–ê–ü–£–°–ö–ê:

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
sudo cp $SERVER_CONFIG /etc/wireguard/wg0.conf
sudo systemctl enable wg-quick@wg0
sudo systemctl start wg-quick@wg0

–ù–∞ –∫–ª–∏–µ–Ω—Ç–µ (Linux):
sudo cp $CLIENT_CONFIG /etc/wireguard/wg0.conf
sudo wg-quick up wg0

–ù–∞ Windows:
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ WireGuard —Å https://www.wireguard.com/install/
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª $CLIENT_CONFIG

–ù–∞ Android/iOS:
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ WireGuard –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –∏–∑ $CONFIG_DIR/qr-codes/client-config.png

5. –ü–†–û–í–ï–†–ö–ê –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø:
ping 10.8.0.1 (—Å –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
ping 10.8.0.2 (—Å —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç)

6. –ü–û–õ–ï–ó–ù–´–ï –ö–û–ú–ê–ù–î–´:
sudo wg show                    # –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
sudo wg-quick down wg0         # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
sudo systemctl status wg-quick@wg0 # –°—Ç–∞—Ç—É—Å —Å–ª—É–∂–±—ã

7. –í–ê–ñ–ù–´–ï IP:
–°–µ—Ä–≤–µ—Ä: $EXTERNAL_IP:51820
–ü–æ–¥—Å–µ—Ç—å VPN: 10.8.0.0/24
–°–µ—Ä–≤–µ—Ä –≤ VPN: 10.8.0.1
–ö–ª–∏–µ–Ω—Ç –≤ VPN: 10.8.0.2
EOF
    
    log "${GREEN}‚úì –§–∞–π–ª —ç–∫—Å–ø–æ—Ä—Ç–∞ —Å–æ–∑–¥–∞–Ω: $EXPORT_FILE${NC}"
    
    # –°–æ–∑–¥–∞–Ω–∏–µ BASE64 —Å—Å—ã–ª–∫–∏ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ (–∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º —Å–∫—Ä–∏–ø—Ç–µ)
    log "${BLUE}‚ñ™ –°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞...${NC}"
    CLIENT_BASE64=$(base64 -w 0 "$CLIENT_CONFIG" 2>/dev/null || base64 "$CLIENT_CONFIG")
    echo "data:text/plain;base64,$CLIENT_BASE64" > "$CONFIG_DIR/import-link.txt"
    log "${GREEN}‚úì –°—Å—ã–ª–∫–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞: $CONFIG_DIR/import-link.txt${NC}"
}

# ==============================================================================
# –®–ê–ì 6: –ü–†–û–í–ï–†–ö–ê –ò –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï
# ==============================================================================
run_tests() {
    log "\n${CYAN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    log "${CYAN}‚ïë          –®–ê–ì 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ            ‚ïë${NC}"
    log "${CYAN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
    log "${BLUE}‚ñ™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤...${NC}"
    if [ -f "$SERVER_CONFIG" ] && [ -f "$CLIENT_CONFIG" ]; then
        log "${GREEN}‚úì –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ${NC}"
    else
        log "${RED}‚úó –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤${NC}"
    fi
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ WireGuard –∫–æ–Ω—Ñ–∏–≥–æ–≤
    log "${BLUE}‚ñ™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤...${NC}"
    if command -v wg &> /dev/null; then
        wg-quick strip "$SERVER_CONFIG" > /dev/null 2>&1 && log "${GREEN}‚úì –ö–æ–Ω—Ñ–∏–≥ —Å–µ—Ä–≤–µ—Ä–∞: —Å–∏–Ω—Ç–∞–∫—Å–∏—Å OK${NC}"
        wg-quick strip "$CLIENT_CONFIG" > /dev/null 2>&1 && log "${GREEN}‚úì –ö–æ–Ω—Ñ–∏–≥ –∫–ª–∏–µ–Ω—Ç–∞: —Å–∏–Ω—Ç–∞–∫—Å–∏—Å OK${NC}"
    fi
    
    # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
    log "${BLUE}‚ñ™ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞...${NC}"
    cat > "$CONFIG_DIR/test-connection.sh" << 'EOF'
#!/bin/bash
echo "–¢–µ—Å—Ç WireGuard –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è"
echo "=========================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω –ª–∏ WireGuard
if ip link show wg0 2>/dev/null | grep -q "wg0"; then
    echo "‚úì –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å wg0 —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º IP –∞–¥—Ä–µ—Å
    WG_IP=$(ip addr show wg0 2>/dev/null | grep -oP 'inet \K[\d.]+')
    if [ -n "$WG_IP" ]; then
        echo "‚úì IP –∞–¥—Ä–µ—Å: $WG_IP"
        
        # –ü—Ä–æ–±—É–µ–º –ø–∏–Ω–≥–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –∫–æ–Ω–µ—Ü
        if [[ "$WG_IP" == "10.8.0.1" ]]; then
            PING_TARGET="10.8.0.2"
        else
            PING_TARGET="10.8.0.1"
        fi
        
        echo "‚ñ™ –ü–∏–Ω–≥ $PING_TARGET ..."
        if ping -c 2 -W 1 "$PING_TARGET" 2>/dev/null | grep -q "bytes from"; then
            echo "‚úì –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!"
        else
            echo "‚ö† –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–ø–∏–Ω–≥–æ–≤–∞—Ç—å $PING_TARGET"
            echo "  –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:"
            echo "  1. –ó–∞–ø—É—â–µ–Ω –ª–∏ WireGuard –Ω–∞ –¥—Ä—É–≥–æ–º –∫–æ–Ω—Ü–µ"
            echo "  2. –û—Ç–∫—Ä—ã—Ç –ª–∏ –ø–æ—Ä—Ç 51820 –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"
            echo "  3. –ü—Ä–∞–≤–∏–ª–∞ —Ñ–∞–µ—Ä–≤–æ–ª–∞"
        fi
    else
        echo "‚ö† –£ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ wg0 –Ω–µ—Ç IP –∞–¥—Ä–µ—Å–∞"
    fi
else
    echo "‚ö† –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å wg0 –Ω–µ –Ω–∞–π–¥–µ–Ω"
    echo "  –ó–∞–ø—É—Å—Ç–∏—Ç–µ WireGuard:"
    echo "  –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ: sudo $CONFIG_DIR/start-server.sh"
    echo "  –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ: sudo $CONFIG_DIR/start-client.sh"
fi

echo ""
echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ —á–µ—Ä–µ–∑ VPN:"
if curl -s --max-time 3 https://api.ipify.org; then
    echo "‚úì –ò–Ω—Ç–µ—Ä–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ VPN"
else
    echo "‚ö† –ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ —á–µ—Ä–µ–∑ VPN"
fi
EOF
    
    chmod +x "$CONFIG_DIR/test-connection.sh"
    log "${GREEN}‚úì –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω: $CONFIG_DIR/test-connection.sh${NC}"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞
    log "${BLUE}‚ñ™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞ 51820...${NC}"
    if timeout 2 bash -c "echo > /dev/tcp/localhost/51820" 2>/dev/null; then
        log "${YELLOW}‚ö† –ü–æ—Ä—Ç 51820 —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è${NC}"
    else
        log "${GREEN}‚úì –ü–æ—Ä—Ç 51820 —Å–≤–æ–±–æ–¥–µ–Ω${NC}"
    fi
}

# ==============================================================================
# –®–ê–ì 7: –°–û–ó–î–ê–ù–ò–ï –§–ê–ô–õ–ê README
# ==============================================================================
create_readme() {
    log "\n${CYAN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    log "${CYAN}‚ïë          –®–ê–ì 7: –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏              ‚ïë${NC}"
    log "${CYAN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    
    # –°–æ–∑–¥–∞–Ω–∏–µ README —Ñ–∞–π–ª–∞
    log "${BLUE}‚ñ™ –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ README...${NC}"
    cat > "$CONFIG_DIR/README.txt" << EOF
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë           WIREGUARD VPN - –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê   ‚ïë
‚ïë                 –í—Å—ë –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!          ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üìÅ –î–ò–†–ï–ö–¢–û–†–ò–Ø: $CONFIG_DIR

üìÑ –°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´:
‚îú‚îÄ‚îÄ wg0-server.conf          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ wg0-client.conf          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
‚îú‚îÄ‚îÄ wg-mobile.conf           # –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
‚îú‚îÄ‚îÄ wg-keys.txt              ‚òÖ –í–°–ï –ö–õ–Æ–ß–ò (—Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ!)
‚îú‚îÄ‚îÄ wg-export-all.txt        # –ü–æ–ª–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –≤—Å–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ start-server.sh          # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ stop-server.sh           # –°–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ start-client.sh          # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞
‚îú‚îÄ‚îÄ test-connection.sh       # –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ import-link.txt          # –°—Å—ã–ª–∫–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∫–æ–Ω—Ñ–∏–≥–∞
‚îî‚îÄ‚îÄ qr-codes/               # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å QR-–∫–æ–¥–∞–º–∏
    ‚îú‚îÄ‚îÄ client-config.png    # QR-–∫–æ–¥ –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    ‚îî‚îÄ‚îÄ client-qr.txt        # –¢–µ–∫—Å—Ç–æ–≤—ã–π QR-–∫–æ–¥

üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢:

1. –ù–ê –°–ï–†–í–ï–†–ï (VPS/–¥–æ–º–∞—à–Ω–∏–π —Å–µ—Ä–≤–µ—Ä):
   sudo $CONFIG_DIR/start-server.sh

2. –ù–ê –ö–õ–ò–ï–ù–¢–ï (Linux):
   sudo $CONFIG_DIR/start-client.sh

3. –ù–ê –¢–ï–õ–ï–§–û–ù–ï (Android/iOS):
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ WireGuard
   - –ù–∞–∂–º–∏—Ç–µ "+" ‚Üí "–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥"
   - –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ $CONFIG_DIR/qr-codes/client-config.png

4. –ü–†–û–í–ï–†–ö–ê:
   $CONFIG_DIR/test-connection.sh

üîß –†–£–ß–ù–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê:

–°–µ—Ä–≤–µ—Ä:
  sudo cp wg0-server.conf /etc/wireguard/wg0.conf
  sudo systemctl enable wg-quick@wg0
  sudo systemctl start wg-quick@wg0

–ö–ª–∏–µ–Ω—Ç (Linux):
  sudo cp wg0-client.conf /etc/wireguard/wg0.conf
  sudo wg-quick up wg0

üì° –ü–û–†–¢–´ –ò IP:
‚Ä¢ –°–µ—Ä–≤–µ—Ä: $EXTERNAL_IP:51820
‚Ä¢ VPN —Å–µ—Ç—å: 10.8.0.0/24
‚Ä¢ –°–µ—Ä–≤–µ—Ä –≤ VPN: 10.8.0.1
‚Ä¢ –ö–ª–∏–µ–Ω—Ç –≤ VPN: 10.8.0.2

‚ö† –í–ê–ñ–ù–û:
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç 51820/udp –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (—Ñ–∞–µ—Ä–≤–æ–ª)
2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª wg-keys.txt –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ
3. –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É [Peer] –∏–∑ wg0-client.conf

üîó –ü–û–õ–ï–ó–ù–´–ï –ö–û–ú–ê–ù–î–´:
sudo wg show                    # –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
sudo wg-quick down wg0         # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
sudo systemctl status wg-quick@wg0 # –°—Ç–∞—Ç—É—Å —Å–ª—É–∂–±—ã
sudo journalctl -u wg-quick@wg0 -f # –õ–æ–≥–∏

üí° –°–û–í–ï–¢–´:
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –ø–æ–¥—Å–µ—Ç–∏ –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ VPN
‚Ä¢ –î–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∑–∞ NAT –æ—Å—Ç–∞–≤—å—Ç–µ PersistentKeepalive = 25
‚Ä¢ MTU 1420 –æ–±—ã—á–Ω–æ –æ–ø—Ç–∏–º–∞–ª–µ–Ω –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–µ—Ç–µ–π

üìû –ü–†–û–ë–õ–ï–ú–´?
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–µ—Ä–≤–æ–ª: sudo ufw allow 51820/udp
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é: ip route show
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: sudo journalctl -u wg-quick@wg0

‚úÖ –í–°–Å –°–î–ï–õ–ê–ù–û! WireGuard –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!
EOF
    
    log "${GREEN}‚úì –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞: $CONFIG_DIR/README.txt${NC}"
}

# ==============================================================================
# –®–ê–ì 8: –§–ò–ù–ê–õ–¨–ù–´–ô –í–´–í–û–î –ò –ò–ù–§–û–†–ú–ê–¶–ò–Ø
# ==============================================================================
show_final_info() {
    log "\n${CYAN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    log "${CYAN}‚ïë                  –ù–ê–°–¢–†–û–ô–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê!                      ‚ïë${NC}"
    log "${CYAN}‚ïë          WireGuard –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ               ‚ïë${NC}"
    log "${CYAN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    
    echo -e "${GREEN}"
    cat << "EOF"
    ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
    ‚ïë   ‚úì –í–°–Å –°–î–ï–õ–ê–ù–û –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò!                   ‚ïë
    ‚ïë   WireGuard VPN –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –≥–æ—Ç–æ–≤!      ‚ïë
    ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
EOF
    echo -e "${NC}"
    
    log "${BLUE}üìÅ –í–°–ï –§–ê–ô–õ–´ –°–û–ó–î–ê–ù–´ –í –î–ò–†–ï–ö–¢–û–†–ò–ò:${NC}"
    echo -e "${GREEN}$CONFIG_DIR/${NC}"
    echo ""
    
    log "${BLUE}üìã –°–û–î–ï–†–ñ–ò–ú–û–ï –î–ò–†–ï–ö–¢–û–†–ò–ò:${NC}"
    ls -la "$CONFIG_DIR/" | tail -n +2
    echo ""
    
    log "${BLUE}üöÄ –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ì–û –ó–ê–ü–£–°–ö–ê:${NC}"
    echo -e "${GREEN}# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:${NC}"
    echo "  sudo $CONFIG_DIR/start-server.sh"
    echo ""
    echo -e "${GREEN}# –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ (Linux):${NC}"
    echo "  sudo $CONFIG_DIR/start-client.sh"
    echo ""
    echo -e "${GREEN}# –ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ:${NC}"
    echo "  –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥: $CONFIG_DIR/qr-codes/client-config.png"
    echo ""
    
    log "${BLUE}üîß –ü–†–û–í–ï–†–ö–ê:${NC}"
    echo "  $CONFIG_DIR/test-connection.sh"
    echo ""
    
    log "${BLUE}üìñ –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø:${NC}"
    echo "  $CONFIG_DIR/README.txt"
    echo ""
    
    log "${BLUE}‚ö† –í–ê–ñ–ù–û:${NC}"
    echo -e "  ${YELLOW}1. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª —Å –∫–ª—é—á–∞–º–∏: $KEYS_FILE${NC}"
    echo -e "  ${YELLOW}2. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç 51820/udp –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–µ—Å–ª–∏ –µ—Å—Ç—å —Ñ–∞–µ—Ä–≤–æ–ª)${NC}"
    echo -e "  ${YELLOW}3. –ü—É–±–ª–∏—á–Ω—ã–π IP —Å–µ—Ä–≤–µ—Ä–∞: $EXTERNAL_IP${NC}"
    echo ""
    
    log "${BLUE}üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:${NC}"
    echo "  1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ"
    echo "  2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ WireGuard –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"
    echo "  3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ WireGuard –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ"
    echo "  4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–º —Å–∫—Ä–∏–ø—Ç–æ–º"
    echo ""
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ —Å–æ –≤—Å–µ–º–∏ —Ñ–∞–π–ª–∞–º–∏
    log "${BLUE}üì¶ –°–û–ó–î–ê–ù–ò–ï –ê–†–•–ò–í–ê –°–û –í–°–ï–ú–ò –§–ê–ô–õ–ê–ú–ò...${NC}"
    cd "$(dirname "$CONFIG_DIR")"
    tar -czf "wireguard-complete-$(date +%Y%m%d).tar.gz" "$(basename "$CONFIG_DIR")" 2>/dev/null
    if [ $? -eq 0 ]; then
        ARCHIVE_PATH="$(pwd)/wireguard-complete-$(date +%Y%m%d).tar.gz"
        log "${GREEN}‚úì –ê—Ä—Ö–∏–≤ —Å–æ–∑–¥–∞–Ω: $ARCHIVE_PATH${NC}"
        echo -e "${GREEN}–ú–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –¥—Ä—É–≥–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:${NC}"
        echo "scp '$ARCHIVE_PATH' user@other-host:~/"
    fi
    
    echo ""
    log "${GREEN}‚úÖ –í–°–Å –ì–û–¢–û–í–û! WireGuard –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!${NC}"
    echo ""
}

# ==============================================================================
# –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø - –í–°–Å –í –û–î–ù–û–ú
# ==============================================================================
main() {
    clear
    
    # –ó–∞–≥–æ–ª–æ–≤–æ–∫
    echo -e "${CYAN}"
    cat << "EOF"
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë      WIREGUARD ALL-IN-ONE GENERATOR v2.0                     ‚ïë
‚ïë      –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ VPN                  ‚ïë
‚ïë      –ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç - –≤—Å—ë —Å–¥–µ–ª–∞–µ—Ç—Å—è —Å–∞–º–æ!          ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
EOF
    echo -e "${NC}"
    
    echo -e "${BLUE}‚ñ™ –°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç –í–°–ï –¥–µ–π—Å—Ç–≤–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:${NC}"
    echo "  1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏"
    echo "  2. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Å–µ –∫–ª—é—á–∏"
    echo "  3. –°–æ–∑–¥–∞—Å—Ç –∫–æ–Ω—Ñ–∏–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∫–ª–∏–µ–Ω—Ç–∞"
    echo "  4. –°–æ–∑–¥–∞—Å—Ç QR-–∫–æ–¥—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤"
    echo "  5. –°–æ–∑–¥–∞—Å—Ç —Å–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è"
    echo "  6. –°–æ–∑–¥–∞—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é"
    echo ""
    echo -e "${YELLOW}–ù–∞–∂–º–∏—Ç–µ Enter —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å (–∏–ª–∏ Ctrl+C –¥–ª—è –æ—Ç–º–µ–Ω—ã)...${NC}"
    read
    
    # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —à–∞–≥–æ–≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
    install_all_dependencies
    if [ $? -ne 0 ]; then
        echo -e "${RED}–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏. –í—ã—Ö–æ–¥.${NC}"
        exit 1
    fi
    
    generate_all_keys
    create_server_config
    create_client_config
    create_qr_and_export
    run_tests
    create_readme
    show_final_info
    
    # –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    echo -e "\n${GREEN}‚ú® –°–ö–†–ò–ü–¢ –í–´–ü–û–õ–ù–ï–ù –£–°–ü–ï–®–ù–û!${NC}"
    echo -e "${BLUE}–ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –≤–≤–æ–¥–∏—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.${NC}"
    echo -e "${BLUE}–í—Å–µ —Ñ–∞–π–ª—ã –≥–æ—Ç–æ–≤—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:${NC} ${GREEN}$CONFIG_DIR${NC}"
    echo ""
    echo -e "${CYAN}–î–ª—è –∑–∞–ø—É—Å–∫–∞ VPN –ø—Ä–æ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:${NC}"
    echo -e "  ${GREEN}–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ: sudo $CONFIG_DIR/start-server.sh${NC}"
    echo -e "  ${GREEN}–ù–∞ –∫–ª–∏–µ–Ω—Ç–µ: sudo $CONFIG_DIR/start-client.sh${NC}"
    echo ""
    echo -e "${YELLOW}–£–¥–∞—á–∏! WireGuard –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ${NC}"
}

# ==============================================================================
# –ó–ê–ü–£–°–ö –°–ö–†–ò–ü–¢–ê
# ==============================================================================

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ bash (—Å–∫—Ä–∏–ø—Ç —Ç—Ä–µ–±—É–µ—Ç bash)
if [ -z "$BASH_VERSION" ]; then
    echo -e "${RED}–û—à–∏–±–∫–∞: –ó–∞–ø—É—Å–∫–∞–π—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —á–µ—Ä–µ–∑ bash${NC}"
    echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: bash $0"
    exit 1
fi

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è
trap 'echo -e "\n${RED}–°–∫—Ä–∏–ø—Ç –ø—Ä–µ—Ä–≤–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º${NC}"; exit 1' INT

# –ó–∞–ø—É—Å–∫ –≥–ª–∞–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
main "$@"